<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>slidPane</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <!-- BEGIN 全局统一样式 -->
    <link rel="stylesheet" href="../lib/metronic/assets/global/plugins/font-awesome/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="../lib/metronic/assets/global/plugins/bootstrap/css/bootstrap.min.css"/>
    <!-- END 全局统一样式 -->
    <!-- BEGIN 主题风格 -->
    <link rel="stylesheet" href="../lib/metronic/assets/global/css/components.css"/>
    <!-- END 主题风格 -->
    <!-- BEGIN PAGE LEVEL STYLES -->
    <link href="../lib/metronic/assets/admin/pages/css/profile.css" rel="stylesheet" type="text/css">
    <link href="../lib/metronic/assets/admin/pages/css/login2.css" rel="stylesheet" type="text/css"/>
    <!-- END PAGE LEVEL SCRIPTS -->
    <style>
      html,body{
        width:100%;
        height:100%;
        display: -webkit-box;
        display: -moz-box;
        display: boxl;
        -webkit-box-orient: vertical;
        -moz-box-orient: vertical;
        box-orient: vertical;
      }
        header {
            background-color: #f2f2f2;
            border-bottom: 1px solid #f2f2f2;
        }
        .header {
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            height:60px;
        }
        .header a{
            display: block;
            padding:20px 30px 20px 30px;
        }
        .title {
            line-height:60px;
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            flex: 1;
            text-align: center;
            font-size:20px;
        }
        .header .menu {
            background-size: 40px;
            background-repeat: no-repeat;
            background-position: center;
            background-image: url("../image/menu.png");
        }
        .dashboard_panel{
          padding: 20px;
          background-color:#F1F3FA;
          -webkit-box-flex:1;
          -moz-box-flex:1;
          box-flex:1;
        }
        .dashboard_panel.margin-top-20.row{
          margin:0px !important;
        }
        .margin-top-20.profile-desc-link a{
          font-size: 14px;
          font-weight: 600;
          color: #5b9bd1 !important;
        }
        .portlet.light.workingtotal{
          min-height:655px;
        }
        .portlet.light.tasks-widget>.portlet-body{
          min-height: 400px;
          overflow-y: auto;
          max-height: 570px;
        }
        a.primary-link{
            color: #65A0D0 !important;
        }
        .login>div.login_panel{
          display: none;
        }
    </style>
</head>
<body class="login">
  <header>
    <div class="header">
        <a class="menu" tapmode="" onclick="sliding()"></a>
        <div class="title" >MES移动平台</div>
        <a></a>
    </div>
  </header>
  <div class="login_panel">
    <!-- BEGIN SIDEBAR TOGGLER BUTTON -->
    <div class="menu-toggler sidebar-toggler">
    </div>
    <!-- END SIDEBAR TOGGLER BUTTON -->
    <!-- BEGIN LOGO -->
    <div class="logo">
      <a href="index.html">
      <img src="../image/logo-big.png" style="height: 17px;" alt=""/>
      </a>
    </div>
    <!-- END LOGO -->
    <!-- BEGIN LOGIN -->
    <div class="content">
      <!-- BEGIN LOGIN FORM -->
      <form class="login-form" action="#">
        <div class="form-title">
          <span class="form-title">欢迎.</span>
          <span class="form-subtitle">请登录.</span>
        </div>
        <div class="alert alert-danger display-hide">
          <button class="close" data-close="alert"></button>
          <span>
          Enter any username and password. </span>
        </div>
        <div class="form-group">
          <!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
          <label class="control-label visible-ie8 visible-ie9">工号</label>
          <input id="username" class="form-control form-control-solid placeholder-no-fix" type="text" autocomplete="off" placeholder="工号" maxlength="6" value="600306"/>
        </div>
        <div class="form-group">
          <label class="control-label visible-ie8 visible-ie9">密码</label>
          <input id="password" class="form-control form-control-solid placeholder-no-fix" type="password" autocomplete="off" placeholder="密码" value="123456"/>
        </div>
        <div class="form-actions">
          <div class="btn btn-primary btn-block uppercase" onclick="login()">登录</div>
        </div>
      </form>
      <!-- END LOGIN FORM -->
    </div>
    <div class="copyright hide">
       2014 © Metronic. Admin Dashboard Template.
    </div>
  </div>
  <div class="dashboard_panel row margin-top-20">
    <div class="col-md-12">
      <div class="profile-sidebar">
        <div class="portlet light profile-sidebar-portlet">
    			<!-- SIDEBAR USERPIC -->
    			<div class="profile-userpic">
    				<img src="../image/profile_user.jpg" class="img-responsive" alt="">
    			</div>
    			<!-- END SIDEBAR USERPIC -->
    			<!-- SIDEBAR USER TITLE -->
    			<div class="profile-usertitle">
    				<div class="profile-usertitle-name">
    					 裁床查片
    				</div>
    				<div class="profile-usertitle-job">
    					 品管部-FQC
    				</div>
    			</div>
    			<!-- END SIDEBAR USER TITLE -->
    			<!-- SIDEBAR BUTTONS -->
    			<div class="profile-userbuttons">
    				<button type="button" class="btn btn-circle green-haze btn-sm">修改密码</button>
    				<button type="button" class="btn btn-circle btn-danger btn-sm">注销登录</button>
    			</div>
    			<!-- END SIDEBAR BUTTONS -->
          <div class="portlet light">
							<!-- STAT -->
							<div class="row list-separated profile-stat">
								<div class="col-md-4 col-sm-4 col-xs-6">
									<div class="uppercase profile-stat-title">
										 3
									</div>
									<div class="uppercase profile-stat-text">
										 负责分类项
									</div>
								</div>
								<div class="col-md-4 col-sm-4 col-xs-6">
									<div class="uppercase profile-stat-title">
										 5
									</div>
									<div class="uppercase profile-stat-text">
										 待完成任务
									</div>
								</div>
								<div class="col-md-4 col-sm-4 col-xs-6">
									<div class="uppercase profile-stat-title">
										 6
									</div>
									<div class="uppercase profile-stat-text">
										 今日已完成
									</div>
								</div>
							</div>
							<!-- END STAT -->
							<div>
								<h4 class="profile-desc-title">关于 MES移动平台</h4>
                <span class="profile-desc-text">平台支持离线保存数据，离线状态时将为您缓存数据，您可以在网络正常时上传您的数据！ </span>
								<h5 class="profile-desc-title">支持人员联系方式</h5>
								<div class="margin-top-20 profile-desc-link">
									<i class="fa fa-envelope"></i>
									<a href="#">wanli.luo@eaglenice.cn</a>
								</div>
								<div class="margin-top-20 profile-desc-link">
									<i class="fa fa-paper-plane"></i>
									<a href="#">13177162433</a>
								</div>
								<div class="margin-top-20 profile-desc-link">
									<i class="fa fa-weixin"></i>
									<a href="#">luowanli_weixin</a>
								</div>
							</div>
						</div>
    		</div>
      </div>
      <div class="profile-content">
        <div class="row">
					<div class="col-md-6">
						<!-- BEGIN PORTLET -->
						<div class="portlet light workingtotal">
							<div class="portlet-title">
								<div class="caption caption-md">
									<i class="icon-bar-chart theme-font hide"></i>
									<span class="caption-subject font-blue-madison bold uppercase">工作汇总</span>
									<span class="caption-helper hide">weekly stats...</span>
								</div>
								<div class="actions">
									<div class="btn-group btn-group-devided" data-toggle="buttons">
										<label class="btn btn-transparent grey-salsa btn-circle btn-sm active">
										<input type="radio" name="options" class="toggle" id="option1">今天</label>
										<label class="btn btn-transparent grey-salsa btn-circle btn-sm">
										<input type="radio" name="options" class="toggle" id="option2">本周</label>
										<label class="btn btn-transparent grey-salsa btn-circle btn-sm">
										<input type="radio" name="options" class="toggle" id="option2">本月</label>
									</div>
								</div>
							</div>
							<div class="portlet-body">
								<div class="row number-stats margin-bottom-30">
									<div class="col-md-6 col-sm-6 col-xs-6">
										<div class="stat-left">
											<div class="stat-chart">
												<!-- do not line break "sparkline_bar" div. sparkline chart has an issue when the container div has line break -->
												<div id="sparkline_bar"><canvas width="90" height="45" style="display: inline-block; width: 90px; height: 45px; vertical-align: top;"></canvas></div>
											</div>
											<div class="stat-number">
												<div class="title">
													 合计
												</div>
												<div class="number">
													 2460
												</div>
											</div>
										</div>
									</div>
									<div class="col-md-6 col-sm-6 col-xs-6">
										<div class="stat-right">
											<div class="stat-chart">
												<!-- do not line break "sparkline_bar" div. sparkline chart has an issue when the container div has line break -->
												<div id="sparkline_bar2"><canvas width="90" height="45" style="display: inline-block; width: 90px; height: 45px; vertical-align: top;"></canvas></div>
											</div>
											<div class="stat-number">
												<div class="title">
													 待处理
												</div>
												<div class="number">
													 719
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="table-scrollable table-scrollable-borderless">
									<table class="table table-hover table-light" id="ReportTab">
									<thead>
									<tr class="uppercase">
										<th colspan="2">
											 分类
										</th>
										<th>
											 目标数
										</th>
										<th>
											 合格数
										</th>
										<th>
											 疵品数
										</th>
										<th>
											 疵品率
										</th>
									</tr>
									</thead>
									<tbody>
                    <tr>
										<td class="fit">
											<img class="user-pic" src="../image/items/01.png">
										</td>
										<td>
											<a href="javascript:;" class="primary-link">裁床查片</a>
										</td>
										<td>
											 3345
										</td>
										<td>
											 3300
										</td>
										<td>
											 45
										</td>
										<td>
											<span class="bold theme-font">80%</span>
										</td>
									</tr>
									<tr>
										<td class="fit">
											<img class="user-pic" src="../image/items/02.png">
										</td>
										<td>
											<a href="javascript:;" class="primary-link">配片</a>
										</td>
										<td>
											 $560
										</td>
										<td>
											 12
										</td>
										<td>
											 24
										</td>
										<td>
											<span class="bold theme-font">67%</span>
										</td>
									</tr>
									<tr>
										<td class="fit">
											<img class="user-pic" src="../image/items/03.png">
										</td>
										<td>
											<a href="javascript:;" class="primary-link">印绣花查片</a>
										</td>
										<td>
											 $1,345
										</td>
										<td>
											 450
										</td>
										<td>
											 46
										</td>
										<td>
											<span class="bold theme-font">98%</span>
										</td>
									</tr>
									<tr>
										<td class="fit">
											<img class="user-pic" src="../image/items/04.png">
										</td>
										<td>
											<a href="javascript:;" class="primary-link">裁床报告</a>
										</td>
										<td>
											 $645
										</td>
										<td>
											 50
										</td>
										<td>
											 89
										</td>
										<td>
											<span class="bold theme-font">58%</span>
										</td>
									</tr>
									</tbody></table>
								</div>
							</div>
						</div>
						<!-- END PORTLET -->
					</div>
          <div class="col-md-6">
  					<!-- BEGIN PORTLET -->
  					<div class="portlet light tasks-widget">
  						<div class="portlet-title">
  							<div class="caption caption-md">
  								<i class="icon-bar-chart theme-font hide"></i>
  								<span class="caption-subject font-blue-madison bold uppercase">任务列表</span>
  								<span class="caption-helper">16 项</span>
  							</div>
  							<div class="inputs">
  								<div class="portlet-input input-small input-inline">
  									<div class="input-icon right">
  										<i class="icon-magnifier"></i>
  										<input type="text" class="form-control form-control-solid" placeholder="搜索...">
  									</div>
  								</div>
  							</div>
  						</div>
  						<div class="portlet-body">
  							<div class="task-content">
                  <div class="scroller" id="tasklist" style="height: 320px;" data-always-visible="1" data-rail-visible1="0" data-handle-color="#D7DCE2">
										<ul class="feeds">
										</ul>
									</div>
                </div>
  						</div>
  					</div>
  					<!-- END PORTLET -->
  				</div>
				</div>
      </div>
    </div>
  </div>
</body>
</html>
<script type="text/javascript" src="../script/api.js"></script>
<script src="../lib/metronic/assets/global/plugins/jquery.min.js"></script>
<script type="text/javascript" src="../script/localstore.js"></script>
<script type="text/javascript" src="../script/user/user.js"></script>
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="../lib/metronic/assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js" type="text/javascript"></script>
<script src="../lib/metronic/assets/global/plugins/jquery.sparkline.min.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
<script>
    function sliding() {
        api.openSlidPane({type: 'left'});
    }
    apiready = function () {
      //$api.fixStatusBar($api.dom('.header'));
      api.addEventListener({
          name: 'keyback'
      }, function(ret, err){
          api.closeWidget();
      });
      LoadUserInfo();
	};

  function login(){
    var empno=$("#username").val();
    var emppwd=$("#password").val();
    if(empno && empno!=""){}else{
      api.alert({title:'提示',msg: '工号不可为空!'});
    }
    if(emppwd && emppwd!=""){}else{
      api.alert({title:'提示',msg: '密码不可为空!'});
    }

    User.Login(empno,emppwd,function(_result){
      if(_result.code=="200"){
        LoadDashBoard();
      }else{
        api.alert({title:'提示',msg: '登录失败:'+_result.msg});
      }
    })
  }
  function LoadUserInfo(){
    var user=User.ThisUser();
    if(user && user.EmpNo && user.EmpNo!=""){
      LoadDashBoard();
    }else{
      $(".login_panel").show();
      $(".dashboard_panel").hide();
    }
  }
  function LoadDashBoard(){
      $(".login_panel").hide(); 
      taskdata=[
        {Time:1576114225000,ModuleName:"ct_chapian_dtl",Title:"CPO：NIK20011336 | 颜色：010 | 床次：21-21",okNum:560,defectNum:42,State:1},
        {Time:1576112112000,ModuleName:"ct_chapian_dtl",Title:"CPO：NIK20030006 | 颜色：011 | 床次：1-1",okNum:867,defectNum:13,State:1},
        {Time:1576110912000,ModuleName:"ct_chapian_dtl",Title:"CPO：NIK20011336 | 颜色：083 | 床次：8-8",okNum:756,defectNum:14,State:1},
        {Time:1576109532000,ModuleName:"ct_chapian_dtl",Title:"CPO：NIK20011357 | 颜色：010 | 床次：5-5",okNum:1124,defectNum:36,State:0},
        {Time:1576063392000,ModuleName:"ct_chapian_dtl",Title:"CPO：NIK20011328 | 颜色：011 | 床次：6-6",okNum:1340,defectNum:10,State:0},
        {Time:1576114225000,ModuleName:"ct_peipian_dtl",Title:"CPO：NIK20011358 | 颜色：010 | 床次：21-21",okNum:653,defectNum:21,State:1},
        {Time:1576112112000,ModuleName:"ct_peipian_dtl",Title:"CPO：NIK20030013 | 颜色：011 | 床次：1-1",okNum:867,defectNum:13,State:1},
        {Time:1576110912000,ModuleName:"ct_peipian_dtl",Title:"CPO：NIK20011366 | 颜色：083 | 床次：8-8",okNum:836,defectNum:30,State:1},
        {Time:1576109532000,ModuleName:"ct_peipian_dtl",Title:"CPO：NIK20011357 | 颜色：010 | 床次：5-5",okNum:925,defectNum:25,State:1},
        {Time:1576063392000,ModuleName:"ct_peipian_dtl",Title:"CPO：NIK20011328 | 颜色：011 | 床次：6-6",okNum:890,defectNum:15,State:1},
        {Time:1576114225000,ModuleName:"ct_pechapian_dtl",Title:"CPO：NIK20011336 | 颜色：010 | 床次：21-21",okNum:940,defectNum:42,State:1},
        {Time:1576112112000,ModuleName:"ct_pechapian_dtl",Title:"CPO：NIK20030006 | 颜色：011 | 床次：1-1",okNum:1209,defectNum:11,State:1},
        {Time:1576110912000,ModuleName:"ct_pechapian_dtl",Title:"CPO：NIK20011336 | 颜色：083 | 床次：8-8",okNum:1226,defectNum:14,State:1},
        {Time:1576109532000,ModuleName:"ct_pechapian_dtl",Title:"CPO：NIK20011357 | 颜色：010 | 床次：5-5",okNum:980,defectNum:20,State:1},
        {Time:1576063392000,ModuleName:"ct_pechapian_dtl",Title:"CPO：NIK20011328 | 颜色：011 | 床次：6-6",okNum:1247,defectNum:13,State:1},
        {Time:1576114225000,ModuleName:"ct_ctreport_dtl",Title:"CPO：NIK20011336 | 颜色：010 | 床次：21-21",okNum:875,defectNum:35,State:1},
        {Time:1576112112000,ModuleName:"ct_ctreport_dtl",Title:"CPO：NIK20030006 | 颜色：011 | 床次：1-1",okNum:1211,defectNum:19,State:1},
        {Time:1576110912000,ModuleName:"ct_ctreport_dtl",Title:"CPO：NIK20011336 | 颜色：083 | 床次：8-8",okNum:980,defectNum:10,State:1},
        {Time:1576109532000,ModuleName:"ct_ctreport_dtl",Title:"CPO：NIK20011357 | 颜色：010 | 床次：5-5",okNum:1144,defectNum:26,State:1},
        {Time:1576063392000,ModuleName:"ct_ctreport_dtl",Title:"CPO：NIK20011328 | 颜色：011 | 床次：6-6",okNum:1322,defectNum:18,State:1},
      ];

      initMiniCharts();
      initTasks();
  }
  function initMiniCharts(){
    $("#sparkline_bar").sparkline([8, 9, 10, 11, 10, 10, 12, 10, 10, 11, 9, 12, 11], {
        type: 'bar',
        width: '100',
        barWidth: 6,
        height: '45',
        barColor: '#F36A5B',
        negBarColor: '#e02222'
    });

    $("#sparkline_bar2").sparkline([9, 11, 12, 13, 12, 13, 10, 14, 13, 11, 11, 12, 11], {
        type: 'bar',
        width: '100',
        barWidth: 6,
        height: '45',
        barColor: '#5C9BD1',
        negBarColor: '#e02222'
    });

    var groupData=groupTotalReport(taskdata);
    var grouphtml="";
    for(var i=0;i<groupData.length;i++){
      grouphtml+=formatReportGroup(groupData[i]);
    }
    $("#ReportTab>tbody").html(grouphtml);
  }
  function formatReportGroup(_groutitem){
    var modul=null;
    for(var i=0;i<LocalStore.ModuleNames.length;i++){
      if(LocalStore.ModuleNames[i].Name==_groutitem.ModuleName){
        modul=LocalStore.ModuleNames[i];
        break;
      }
    }
    if(modul==null){return "";}
    var ihtml='<tr>';
    ihtml+='<td class="fit"><img class="user-pic" src="../image/items/'+modul.img+'"></td>';
    ihtml+='<td><a href="javascript:;" class="primary-link">'+modul.Title+'</a></td>';
    ihtml+='<td>'+(_groutitem.okNum+_groutitem.defectNum)+'</td>';
    ihtml+='<td>'+_groutitem.okNum+'</td>';
    ihtml+='<td>'+_groutitem.defectNum+'</td>';
    ihtml+='<td><span class="bold theme-font">'+(parseInt(_groutitem.defectNum/(_groutitem.okNum+_groutitem.defectNum)*100))+'%</span></td>';
    ihtml+='</tr>';
    return ihtml;
  }
  var taskdata=null;
  function initTasks(){
    var tsklist="";
    taskdata=taskdata.sort(function(x,y){
      if (x.Time < y.Time) {
          return 1;
      } else if (x.Time > y.Time) {
          return -1;
      } else {
          return 0;
      }
    });
    for(var i=0;i<taskdata.length;i++){
      tsklist+=formatTaskItem(taskdata[i]);
    }
    $("#tasklist>ul").html(tsklist);
  }
  function groupTotalReport(_taskdata){
    var groupdata=[];//{ModuleName:"ct_chapian_dtl",okNum:560,defectNum:42}
    var groupKeys=[];
    var tempindex=-1;
    for(var i=0;i<_taskdata.length;i++){
      tempindex=groupKeys.indexOf(_taskdata[i].ModuleName);
      if(tempindex>-1){
        groupdata[tempindex].okNum+=_taskdata[i].okNum;
        groupdata[tempindex].defectNum+=_taskdata[i].defectNum;
      }else{
        groupKeys.push(_taskdata[i].ModuleName);
        groupdata.push({ModuleName:_taskdata[i].ModuleName,okNum:_taskdata[i].okNum,defectNum:_taskdata[i].defectNum});
      }
    }
    return groupdata;
  }
  function formatTaskItem(task){
    var stateico='<div class="label label-sm label-danger"><i class="fa fa-bell-o"></i></div>';
    if(task.State && task.State==1){
      stateico='<div class="label label-sm label-success"><i class="fa fa-check"></i></div>';
    }
    var itemhtml='<li>';
      itemhtml+='<div class="col1">';
      itemhtml+='<div class="cont">';
      itemhtml+='<div class="cont-col1">'+stateico+'</div>';
      itemhtml+='<div class="cont-col2"><div class="desc">'+task.Title+getModuleName(task.ModuleName)+'</div></div>';
      itemhtml+='</div></div>';
      itemhtml+='<div class="col2"><div class="date">'+getTimeSpace(task.Time)+'</div></div>';
      itemhtml+='</li>';
    return itemhtml;
  }
  function getModuleName(moduleName){
    var colors=["label-default","label-primary","label-success","label-info","label-warning","label-danger"];
    for(var i=0;i<LocalStore.ModuleNames.length;i++){
      if(LocalStore.ModuleNames[i].Name==moduleName){
        return '  <span class="label label-sm '+colors[i%colors.length]+'">'+LocalStore.ModuleNames[i].Title+'</span>';
      }
    }
  }
  function getTimeSpace(befortime){
    var spaceTitle="刚刚";
    var nowt=Date.parse(new Date());
    var spacevalue=parseInt((nowt-befortime)/1000/60);
    if(spacevalue>3 && spacevalue<60){
      spaceTitle=spacevalue+" 分钟前";
    }
    if(spacevalue>=60 && spacevalue<1440){
      spaceTitle=parseInt(spacevalue/60)+" 小时前";
    }
    if(spacevalue>=1440){
      spaceTitle=parseInt(spacevalue/60/24)+" 天前";
    }
    return spaceTitle;
  }
</script>
